import{J as de,V as he,r as o,x as l,O as u,j as n,M as i,av as g,ba as k,ay as S,Y as V,a9 as W,ac as p,bn as ue,bm as pe,aS as fe,ae as be,af as ge}from"../multikey/multikey.D1_AnZj2.js";import{a as d,u as ye,d as Ce,b as ve,M as xe,e as U,t as ke,f as Se}from"../multikey/multikey.DANc9zrZ.js";import{P as we}from"../multikey/multikey.CSfMaGzx.js";const He=()=>{const w=d.getCache("current"),{t:r}=de(),j=he(),[f,$]=o.useState(""),y=ye(Ce),[b,q]=o.useState(2),[s,N]=o.useState([w.account,"",""]),[C,A]=o.useState(null),[v,x]=o.useState(null),[m,D]=o.useState([]),[G,T]=o.useState(!1),[J,Y]=o.useState(""),[Z,H]=o.useState(!1),[K,B]=o.useState(!0),[O,Q]=o.useState(!0),z=ve(),M=o.useCallback(async()=>{if(y){const t=d.formatUnits(y.amount,y.digits);Q(d.greaterThanZero(t,.1))}},[y]);o.useEffect(()=>{M()},[M]);const E=o.useCallback(t=>{const e=t.trim();if(e.length<=0){const a={text:r("home.inputName"),boo:!0};return A(a),!1}else if(e.length>20){const a={text:r("home.nameLength"),boo:!0};return A(a),!1}else return A({text:"",boo:!1}),!0},[r]),R=t=>{const{value:e}=t.target;$(e),E(e)},P=o.useCallback((t,e)=>{if(t.trim().length<=0)return D(()=>{const c={text:r("home.inputSign"),boo:!0};return m[e]=c,[...m]}),!1;if(d.validateAddress(t)){if(s.some((c,h)=>{if(h!==e)return c===t}))return D(()=>{const c={text:r("home.save"),boo:!0};return m[e]=c,[...m]}),!1;{const c={text:"",boo:!1};return m[e]=c,!0}}else return D(()=>{const c={text:r("home.addreeType"),boo:!0};return m[e]=c,[...m]}),!1},[m,s,r]),X=(t,e)=>{N(()=>(s[e]=t,[...s])),P(t,e)},_=o.useCallback(t=>{const e=t?parseInt(String(t),10):0;if(e)if(e<2){const a={text:r("home.min"),boo:!0};return x(a),!1}else if(e>s.length){const a={text:r("home.limit",{num:s.length}),boo:!0};return x(a),!1}else return x({text:"",boo:!1}),!0;else{const a={text:r("home.inputNum"),boo:!0};return x(a),!1}},[s.length,r]),ee=t=>{const{value:e}=t.target,a=d.formatDecimalPlaces(e,0)?d.formatDecimalPlaces(e,0):"";q(a),_(a)},F=()=>{T(!1)},te=()=>{T(!1),s.length>=15?(T(!0),Y(r("home.limit",{num:15}))):N(()=>(s.push(""),[...s]))},ne=t=>{N(()=>(s.splice(t,1),[...s]))},re=()=>{const t=E(f),e=_(String(b));s.map((h,I)=>P(h,I)).every(h=>h===!0)&&t&&e&&B(!1)},ae=()=>{H(!1)},se=o.useMemo(()=>({jsonrpc:"2.0",method:"ibax.getList",id:Date.now(),params:[{name:"@1multi_sign_wallets",where:`{'owners -> ${w.account}': 1}`,order:{id:1},offset:0,limit:10}]}),[w.account]),L=async()=>{H(!1);const t=await z(U(se));if(U.fulfilled.match(t)&&(t.payload.list?t.payload.list:[]).length){const a=t.payload.list[0];z(ke(a)),z(Se({id:a.id,changes:{isSelect:!0}}))}j("/",{replace:!0})},oe=()=>{B(!0)},le=()=>{try{if(d.getCacheToken("type")==="jutkey_connect"){const e=d.currNetwork(),{walletId:a}=e,c=a,{host:h,origin:I}=document.location,ce={host:h,origin:I},me={contractName:"MultiSignCreateWallet",TeamName:f,Owners:s,Threshold:b};chrome.runtime.sendMessage(c,{path:"notice/contract",params:{pageInfo:ce,contractParams:me}},Ne=>{})}else H(!0)}catch{}},ie=()=>{j("/",{replace:!0})};return o.useEffect(()=>{document.addEventListener("jutkeyEvent",async({detail:t})=>{d.getCacheToken("type"),t.type==="jutkey_contract"&&L()})}),l(xe,{children:[K?l(u,{children:[n(i,{variant:"h5",mb:2,children:r("home.setting")}),n(i,{variant:"body1",mb:3,sx:{width:{md:"40%",sm:"100%"}},children:r("home.des")}),l("form",{autoComplete:"off",children:[l(g,{sx:{width:{md:"60%",sm:"100%"},display:"block",mb:3},children:[n(i,{variant:"h6",mb:2,children:r("home.team")}),n(i,{variant:"body2",mb:2,children:r("home.name")}),n(k,{placeholder:r("home.inputName"),size:"medium",fullWidth:!0,value:f,onChange:R,error:C?C.boo:!1}),n(S,{error:!0,children:C?C.text:""})]}),s.map((t,e)=>l(g,{sx:{width:{md:"60%",sm:"100%"},display:"block",mb:3},required:!0,children:[n(i,{variant:"body1",mb:2,children:r("home.sign",{num:e+1})}),e===0?l(V,{children:[n(k,{placeholder:r("home.inputSign"),size:"medium",fullWidth:!0,value:t,disabled:!0}),n(S,{error:!0})]}):l(V,{children:[l(W,{direction:"row",children:[n(k,{placeholder:r("home.inputSign"),size:"medium",fullWidth:!0,value:s[e]||"",onChange:a=>{const{value:c}=a.target;X(c,e)},error:m[e]?m[e].boo:!1}),e>=3?n(p,{variant:"outlined",sx:{ml:1,minWidth:150},onClick:()=>{ne(e)},size:"large",children:r("home.delete")}):""]}),n(S,{error:!0,children:m[e]?m[e].text:""})]})]},e)),n(g,{sx:{width:{md:"60%",sm:"100%"},display:"block",mb:3,mt:4},children:n(p,{variant:"filled",startIcon:n(ue,{}),onClick:te,sx:{minWidth:150,lineHeight:2.4},size:"large",children:r("home.new")})}),l(g,{sx:{width:{md:"60%",sm:"100%"},display:"block",mb:1},children:[l(W,{direction:"row",spacing:3,mb:3,children:[n(i,{variant:"body1",mb:2,children:r("home.num")}),n(fe,{title:r("home.signtip"),placement:"bottom",children:n(pe,{fontSize:"medium",sx:{cursor:"pointer"}})})]}),n(k,{placeholder:r("home.inputNum"),size:"medium",type:"InputNumber",sx:{width:60},value:b,onChange:ee,error:v?v.boo:!1}),n(i,{component:"span",variant:"body2",ml:1,children:r("home.over",{num:s.length})}),n(S,{error:!0,children:v?v.text:""})]}),n(g,{sx:{width:{md:"60%",sm:"100%"},display:"block",mb:1,mt:5,textAlign:"center"},children:l(W,{direction:"row",justifyContent:"space-around",children:[n(p,{sx:{minWidth:150,lineHeight:2.4},variant:"outlined",onClick:ie,color:"primary",size:"large",children:r("login.cancel")}),n(p,{sx:{minWidth:150,lineHeight:2.4},variant:"filled",onClick:re,color:"primary",size:"large",children:r("home.continue")})]})})]})]}):l(u,{children:[n(i,{variant:"h5",mb:2,children:r("home.sure")}),n(i,{variant:"body1",mb:3,children:r("home.mistake")}),l(u,{display:"flex",mb:2,children:[l(i,{variant:"body1",children:[r("home.team"),":"]}),n(i,{variant:"body1",ml:.5,children:f})]}),n(i,{variant:"body1",mb:1,children:r("home.mulAddress")}),n(u,{mb:2,children:s.map((t,e)=>n(i,{variant:"body1",mb:1,children:t},e))}),n(i,{variant:"body1",mb:2,children:r("home.signAll",{num:b,length:s.length})}),l(u,{sx:{width:{md:"60%",sm:"100%"},display:"flex",justifyContent:"space-around",mb:1,mt:5,textAlign:"center"},children:[n(p,{sx:{minWidth:150,lineHeight:2.4},variant:"outlined",onClick:oe,color:"primary",size:"large",children:r("login.previous")}),l(u,{children:[n(p,{sx:{minWidth:150,lineHeight:2.4},variant:"filled",onClick:le,color:"primary",size:"large",disabled:!O,children:r("home.build")}),O?"":n(i,{variant:"body2",color:t=>t.palette.error.light,mt:1,children:r("home.noGas")})]})]})]}),n(ge,{anchorOrigin:{vertical:"top",horizontal:"center"},open:G,onClose:F,autoHideDuration:3e3,children:n(be,{onClose:F,severity:"error",variant:"filled",sx:{width:"100%"},children:J})}),n(we,{isCheck:Z,params:{contractName:"MultiSignCreateWallet",TeamName:f,Owners:s,Threshold:b},close:ae,confirm:L})]})};export{He as Component};
