import{U as Q,r as m,a6 as V,x as r,j as e,a3 as _,bl as X,bm as Z,bq as ee,bo as $,bp as y,a_ as B,a2 as t,H as d,G as p,aD as R,br as ne,Y as te,ac as ae,a4 as oe,af as re}from"../multikey/multikey.B-gp-w2q.js";import{u as se,g as ie,l as N,h as T,a as b,S as F,M as le}from"../multikey/multikey.CWNOg_8L.js";import{h as E,b as f}from"../multikey/multikey.BNP3VytQ.js";const ce=()=>{const{t:o}=Q(),[c,w]=m.useState(null),[s,v]=m.useState(null),[D,L]=m.useState(0),l=se(ie),H=V(),S=m.useRef(1),[z,M]=m.useState(!1),[q,W]=m.useState(!1),x=10,h=m.useMemo(()=>({jsonrpc:"2.0",method:"ibax.getList",id:1,params:[{name:"@1multi_sign_proposals",where:`{"$or": ["wallet": "${l.wallet}", "$and": [{"to":"${l.wallet}"},{"status": "finished"}]]}`,offset:0,limit:x,order:{id:-1}}]}),[l.wallet]),[A,G]=m.useState(h.params[0].limit),j=m.useCallback(async()=>{const n=await N(h);if(n!=null&&n.list){const a=[];n.list.forEach(u=>{a.push({jsonrpc:"2.0",method:"ibax.ecosystemInfo",id:2,params:[Number(u.ecosystem)]})});const i=await T(a);v(i),w(n)}else v(null),w(null)},[h]);m.useEffect(()=>{l.wallet&&j()},[j,l.wallet]);const U=async(n,a)=>{h.params[0].offset=a*h.params[0].limit,L(a);const i=await N(h);if(i){const u=[];i.list.forEach(P=>{u.push({jsonrpc:"2.0",method:"ibax.ecosystemInfo",id:2,params:[Number(P.ecosystem)]})});const C=await T(u);v(C),w(i)}},Y=n=>{G(+n.target.value),L(0)},g=(n,a)=>{const i={...n,digits:a.digits,tokenSymbol:a.token_symbol,tokenName:a.token_name};H({pathname:"/message/details",search:`?${re(i)}`})},O=async n=>{if(z)return;const{target:a}=n,i=a,{scrollHeight:u,scrollTop:C,offsetHeight:P}=i;C+P>=u-25&&Math.ceil(c.count/x)>S.current&&!z&&(M(!0),S.current+=1,h.params[0].offset=(S.current-1)*x,setTimeout(async()=>{const k=await N(h);if(Math.ceil(c.count/x)>S.current?W(!0):W(!1),k){const I=[];k.list.forEach(K=>{I.push({jsonrpc:"2.0",method:"ibax.ecosystemInfo",id:2,params:[Number(K.ecosystem)]})});const J=await T(I);v(()=>[...s,...J]),w(()=>({count:k.count,list:[...c.list,...k.list]}))}M(!1)},500))};return r(le,{children:[e(p,{sx:{display:{xs:"none",sm:"none",md:"block"}},children:c?r(_,{children:[e(X,{sx:{minHeight:500},children:e(Z,{sx:{minWidth:650},stickyHeader:!0,"aria-label":"sticky table",children:e(ee,{children:c.list&&s?c.list.map((n,a)=>r($,{sx:{"& > *":{borderBottom:"unset"}},children:[e(y,{align:"left",width:200,children:e(B,{title:E(Number(n.created_at)*1e3),placement:"bottom",children:e(t,{variant:"body2",sx:{cursor:"pointer"},children:f(Number(n.created_at))<60?`${f(Number(n.created_at))} ${o("home.second")}`:f(Number(n.created_at))})})}),e(y,{align:"center",children:n.to===l.wallet?e(d,{direction:"row",children:r(p,{sx:{cursor:"pointer",color:i=>i.palette.primary.main,textDecoration:"underline"},onClick:()=>{g(n,s[a].result)},children:[e(t,{variant:"body2",component:"span",fontWeight:600,children:l.team_name}),e(t,{variant:"body2",component:"span",ml:1,children:o("home.achieve",{to:n.wallet})}),e(t,{variant:"body2",component:"span",ml:.5,children:b.formatFixed(n.amount,s[a].result.digits)}),e(t,{variant:"body2",component:"span",ml:.5,children:s[a].result.token_symbol})]})}):n.status==="ongoing"?e(d,{direction:"row",children:r(p,{sx:{cursor:"pointer",color:i=>i.palette.primary.main,textDecoration:"underline"},onClick:()=>{g(n,s[a].result)},children:[e(t,{variant:"body2",component:"span",fontWeight:600,children:l.team_name}),e(t,{variant:"body2",component:"span",ml:1,children:o("home.initiate")}),e(t,{variant:"body2",component:"span",ml:.5,children:b.formatFixed(n.amount,s[a].result.digits)}),r(t,{variant:"body2",component:"span",ml:.5,children:[s[a].result.token_symbol,","]}),e(t,{variant:"body2",component:"span",ml:1,children:o("home.wait")})]})}):n.status==="finished"?e(d,{direction:"row",children:r(p,{sx:{cursor:"pointer",color:i=>i.palette.primary.main,textDecoration:"underline"},onClick:()=>{g(n,s[a].result)},children:[e(t,{variant:"body2",component:"span",fontWeight:600,children:l.team_name}),e(t,{variant:"body2",component:"span",ml:1,children:o("home.initiate")}),e(t,{variant:"body2",component:"span",ml:.5,children:b.formatFixed(n.amount,s[a].result.digits)}),r(t,{variant:"body2",component:"span",ml:.5,children:[s[a].result.token_symbol,","]}),e(t,{variant:"body2",component:"span",ml:1,children:o("home.finish")})]})}):""}),r(y,{align:"center",children:["2/",l.owner_quantity]}),e(y,{align:"center",children:e(R,{onClick:()=>{g(n,s[a].result)},sx:{fontSize:12},size:"large",children:o("home.examine")})})]},n.id)):e($,{sx:{"& > *":{borderBottom:"unset"}},children:e(y,{align:"center",colSpan:6,children:e(t,{variant:"body1",children:o("login.no")})})})})})}),c&&c.count?e(ne,{rowsPerPageOptions:[h.params[0].limit],component:"div",count:c.count,rowsPerPage:A,page:D,onPageChange:U,onRowsPerPageChange:Y}):e(F,{num:3})]}):e(t,{textAlign:"center",children:o("home.noMessage")})}),e(p,{sx:{display:{xs:"block",sm:"block",md:"none"}},width:"100%",children:c?r(te,{sx:{width:"100%",maxWidth:"100%",height:"80vh",overflowY:"auto",pb:5},onScroll:O,children:[c.list&&s?c.list.map((n,a)=>e(ae,{sx:{p:2,backgroundColor:i=>i.palette.surfaceContainer.main,borderRadius:5,mb:2,cursor:"pointer"},children:r(p,{width:"100%",children:[r(d,{direction:"row",justifyContent:"space-between",mb:.5,width:"100%",spacing:2,children:[r(d,{direction:"row",flexShrink:0,alignItems:"center",children:[r(t,{mr:1,variant:"body2",fontSize:12,children:[o("home.time"),":"]}),e(B,{title:E(Number(n.created_at)*1e3),placement:"bottom",children:e(t,{variant:"body2",sx:{cursor:"pointer"},children:f(Number(n.created_at))<60?`${f(Number(n.created_at))} ${o("home.second")}`:f(Number(n.created_at))})})]}),r(d,{direction:"row",flexShrink:0,alignItems:"center",children:[r(t,{mr:1,variant:"body2",fontSize:12,children:[o("home.signnum"),":"]}),r(t,{variant:"body2",sx:{cursor:"pointer"},children:[l.threshold,"/",l.owner_quantity]})]}),e(R,{onClick:()=>{g(n,s[a].result)},sx:{fontSize:12},size:"large",children:o("home.examine")})]}),e(d,{direction:"row",justifyContent:"space-between",width:"100%",mb:1,children:e(d,{direction:"row",flexShrink:0,alignItems:"center",flexWrap:"wrap",sx:{wordBreak:"break-word"},children:n.status==="ongoing"?r(d,{direction:"row",flexWrap:"wrap",children:[e(t,{variant:"body2",component:"span",fontSize:12,children:l.team_name}),e(t,{variant:"body2",component:"span",ml:1,fontSize:12,children:o("home.initiate")}),e(t,{variant:"body2",component:"span",ml:.5,fontSize:12,children:b.formatFixed(n.amount,s[a].result.digits)}),e(t,{variant:"body2",component:"span",ml:.5,fontSize:12,children:s[a].result.token_symbol}),e(t,{variant:"body2",component:"span",ml:1,fontSize:12,children:o("home.wait")})]}):n.status==="finished"?r(d,{direction:"row",flexWrap:"wrap",children:[e(t,{variant:"body2",component:"span",fontSize:12,fontWeight:600,children:l.team_name}),e(t,{variant:"body2",component:"span",ml:1,fontSize:12,children:o("home.initiate")}),e(t,{variant:"body2",component:"span",ml:.5,fontSize:12,children:b.formatFixed(n.amount,s[a].result.digits)}),e(t,{variant:"body2",component:"span",ml:.5,fontSize:12,children:s[a].result.token_symbol}),e(t,{variant:"body2",component:"span",ml:1,fontSize:12,children:o("home.finish")})]}):""})}),n.to===l.wallet?r(d,{direction:"row",flexWrap:"wrap",children:[e(t,{variant:"body2",component:"span",sx:{fontWeight:600},fontSize:12,children:l.team_name}),e(t,{variant:"body2",component:"span",ml:1,fontSize:12,children:o("home.achieve",{to:n.to})}),e(t,{variant:"body2",component:"span",ml:.5,fontSize:12,children:b.formatFixed(n.amount,s[a].result.digits)}),e(t,{variant:"body2",component:"span",ml:.5,fontSize:12,children:s[a].result.token_symbol})]}):""]})},n.id)):e(F,{num:3}),e(p,{sx:{display:"flex",justifyContent:"center",alignItems:"center",mt:3},children:z?r(_,{children:[e(oe,{size:20}),e(t,{variant:"body2",ml:2,children:o("nav.load")})]}):q?e(_,{children:e(t,{variant:"body2",ml:2,children:o("nav.drop")})}):e(_,{children:e(t,{variant:"body2",ml:2,children:o("nav.nomore")})})})]}):e(t,{variant:"body1",textAlign:"center",children:o("login.no")})})]})};ce.displayName="MessagePage";export{ce as Component};
