import{J as je,r as s,V as ze,b8 as Fe,x as d,j as n,M as p,S as ee,N as te,a9 as N,K as W,a_ as ae,Y as We,a2 as $e,O as ne,av as E,aR as T,ba as _,$ as k,ay as $,aS as He,bm as Be,ac as re}from"../multikey/multikey.D1_AnZj2.js";import{b as Le,u as Re,g as Ue,k as P,c as Ve,h as qe,a as i,M as Oe,i as Ge}from"../multikey/multikey.DANc9zrZ.js";import{P as se}from"../multikey/multikey.CSfMaGzx.js";import{u as Je}from"../multikey/multikey.Dix-r58g.js";const Ze=[{label:"address",value:"address"},{label:"iName",value:"iName"}],Ke=window,at=()=>{const{t:r}=je(),[S,oe]=s.useState("address"),[e,le]=s.useState(null),[g,M]=s.useState(""),[b,m]=s.useState(null),[C,H]=s.useState(""),[f,w]=s.useState(null),[c,B]=s.useState(""),[L,ie]=s.useState(""),[de,ce]=s.useState(0),[me,ue]=s.useState(1),[x,v]=s.useState(null),[A,R]=s.useState(""),[U,j]=s.useState(!1),[u,he]=s.useState([]),V=ze(),pe=Le(),D=Re(Ue),{id:h,keyId:y,tokenSymbol:q}=Fe(),[ge,be]=s.useState(h),[fe,O]=s.useState(r("home.recipient")),xe=s.useMemo(()=>({jsonrpc:"2.0",method:"ibax.getList",id:1,params:[{name:"@1multi_sign_proposals",where:`{"wallet": ${D.wallet},"status": "ongoing"}`,limit:10,columns:"id"}]}),[D.wallet]),G=s.useMemo(()=>[{jsonrpc:"2.0",method:"ibax.getBalance",id:1,params:[P.addressString(y),Number(h)]}],[h,y]),J=s.useMemo(()=>({jsonrpc:"2.0",method:"ibax.getList",id:1,params:[{name:"@1ecosystems",where:`{id:${h}}`}]}),[h]),Z=s.useCallback(async()=>{const t=await Ve(J);if(t&&t.list){const a=t.list[0];if(a.fee_mode_info!=="NULL"){const o=JSON.parse(a.fee_mode_info);Number(o.fee_mode_detail.expedite_fee.flag)===2&&(ue(Number(o.fee_mode_detail.expedite_fee.flag)),ce(Number(o.follow_fuel)))}}},[J]),K=s.useCallback(async()=>{const t=await qe(G);if(t&&t[0].result){const a=t[0].result;le(a)}},[G]);s.useEffect(()=>{K(),Z()},[K,Z]);const X=s.useCallback(t=>{const a=t.trim(),o=/^[\w]{4,20}$/;if(S==="address")if(a.length<=0){const l={text:r("home.recipient"),boo:!0};return m(l),!1}else{if(i.validateAddress(t))return m({text:"",boo:!1}),!0;{const l={text:r("home.addreeType"),boo:!0};return m(l),!1}}else if(a.length<=0){const l={text:r("home.iName"),boo:!0};return m(l),!1}else{if(o.test(t))return m({text:"",boo:!1}),!0;{const l={text:r("home.nickname"),boo:!0};return m(l),!1}}},[r,S]),ye=t=>{const{value:a}=t.target;M(a),X(a)},Y=s.useCallback(t=>{const a=i.formatUnits(e==null?void 0:e.amount,e==null?void 0:e.digits);if(Number(t)<=0){const o={text:r("home.maxZero"),boo:!0};return w(o),!1}else if(i.comparedTo(t,a)){const o={text:r("home.maxAmount",{num:a,tokenSymbol:e==null?void 0:e.token_symbol}),boo:!0};return w(o),!1}else return w({text:"",boo:!1}),!0},[e==null?void 0:e.amount,e==null?void 0:e.digits,e==null?void 0:e.token_symbol,r]),Se=t=>{const{value:a}=t.target;Number(a)>=0&&(H(i.formatDecimalPlaces(a,e.digits)),Y(a))},Q=s.useCallback(t=>{const a=i.formatUnits(e==null?void 0:e.amount,e==null?void 0:e.digits);if(t.trim().length>0)if(Number(t)<=0){const l={text:r("home.maxZero"),boo:!0};return v(l),!1}else if(i.comparedTo(t,a)){const l={text:r("home.maxAmount",{num:a,tokenSymbol:e==null?void 0:e.token_symbol}),boo:!0};return v(l),!1}else return v({text:"",boo:!1}),!0;else return!0},[e==null?void 0:e.amount,e==null?void 0:e.digits,e==null?void 0:e.token_symbol,r]),Ce=t=>{const{value:a}=t.target;if(Number(a)>=0){B(i.formatDecimalPlaces(a,e.digits));const o=i.formatFixed(Number(a)/(de*10**e.digits),0);ie(o),Q(a)}},Ne=t=>{const{value:a}=t.target;R(a)},ke=Je(()=>{try{const t=X(g),a=Y(C),o=Q(c);if(t&&a&&o)if(i.getCacheToken("type")==="jutkey_connect"){const De=i.currNetwork(),{walletId:Ee}=De,Te=Ee,{host:_e,origin:Pe}=document.location,Me={host:_e,origin:Pe},F={contractName:"MultiSignPropose",Wallet:P.addressString(y),Amount:i.parseUnits(C,Number(e==null?void 0:e.digits)),digits:Number(e==null?void 0:e.digits),Ecosystem:Number(h),Expedite:String(c)?String(c):"0",Proposal:A};S==="address"?F.To=g:F.iName=g,chrome.runtime.sendMessage(Te,{path:"notice/contract",params:{pageInfo:Me,contractParams:F}},Ye=>{})}else j(!0)}catch{}}),we=()=>{M(""),H(""),B(""),R(""),m(null),w(null),v(null)},I=()=>{j(!1)},z=async()=>{j(!1),await pe(Ge(xe)),V("/",{replace:!0})},ve=async t=>{const{value:a}=t.target,o={text:"",boo:!1};M(""),m(o),oe(t.target.value),O(r(a==="address"?"home.recipient":"home.iName"))},Ae=async t=>{const a=t.target.value,o=u==null?void 0:u.find(l=>Number(l.id)===Number(a));be(a),V(`/transfer/${o==null?void 0:o.tokenSymbol}/${a}/${y}`,{replace:!0}),Ke.location.reload()};return s.useEffect(()=>{(()=>{const a=i.getCache(`${D.wallet}-all`)||[];a.length&&he(a)})()},[D.wallet]),s.useEffect(()=>{document.addEventListener("jutkeyEvent",async({detail:t})=>{i.getCacheToken("type"),t.type==="jutkey_contract"&&z()})}),d(Oe,{children:[n(p,{variant:"h5",mb:3,children:r("home.transfer")}),n(N,{textAlign:"center",direction:"row",justifyContent:"center",children:u&&(u!=null&&u.length)?n(ee,{sx:{"& fieldset":{border:"none"},"& .MuiInputBase-input.MuiSelect-select":{display:"flex",alignItems:"center",backgroundColor:t=>t.palette.onBody.main},"& .MuiTypography-root":{mr:1}},size:"medium",MenuProps:{style:{maxHeight:400}},labelId:"token-simple-select-label",id:"token-simple-select",value:ge,onChange:Ae,children:u.map(t=>n(te,{value:t.id,sx:{mb:1},children:d(N,{flexGrow:0,direction:"row",alignItems:"center",children:[t.id===1?n(W,{src:"/logo-big.png",sx:{width:30,height:30},children:n(ae,{})}):n(We,{children:t.logoURI?n(W,{src:t.logoURI,sx:{width:30,height:30}}):n(W,{sx:{width:30,height:30},children:n(ae,{fontSize:"medium"})})}),n($e,{primary:`${t.tokenSymbol}#${t.id}`,sx:{ml:1}})]})},t.id))}):""}),d(N,{textAlign:"center",direction:"row",justifyContent:"center",mb:2,children:[d(p,{variant:"h6",children:[r("home.balance"),":"]}),n(p,{variant:"h6",ml:1,children:i.formatFixed(e==null?void 0:e.amount,e==null?void 0:e.digits)}),n(p,{variant:"h6",ml:1,children:q})]}),n(ne,{display:"flex",justifyContent:"center",children:d(ne,{sx:{width:{md:"60%",sm:"100%"}},children:[d(E,{fullWidth:!0,sx:{mb:2},children:[n(T,{variant:"outlined",htmlFor:"outlined-adornment-address",required:!0,sx:{fontSize:16},error:b?b.boo:!1,children:r("home.send")}),n(_,{fullWidth:!0,placeholder:fe,size:"medium",autoComplete:"off",value:g,id:"outlined-adornment-address",onChange:ye,startAdornment:n(k,{position:"start"}),sx:{paddingRight:0},endAdornment:n(k,{position:"end",children:n(ee,{labelId:"lang-select-helper-label",id:"type-select-helper",value:S,size:"medium",placeholder:"",onChange:ve,inputProps:{name:"languages",id:"uncontrolled-native"},sx:{border:"none",":before":{borderColor:"divider"},bgcolor:"secondary.light",fontStyle:"italic"},children:Ze.map(({value:t,label:a})=>n(te,{value:t,sx:{mt:1},children:a},t))})}),label:r("home.send"),error:b?b.boo:!1}),n($,{error:!0,children:b?b.text:""})]}),d(E,{fullWidth:!0,sx:{mb:2},children:[n(T,{htmlFor:"outlined-adornment-count",required:!0,sx:{fontSize:16},error:f?f.boo:!1,children:r("home.count")}),n(_,{id:"outlined-adornment-count",placeholder:r("home.dir"),type:"InputNumber",autoComplete:"off",size:"medium",fullWidth:!0,value:C,onChange:Se,startAdornment:n(k,{position:"start"}),label:r("home.count"),error:f?f.boo:!1}),n($,{error:!0,children:f?f.text:""})]}),d(E,{fullWidth:!0,sx:{mb:2},children:[n(T,{htmlFor:"outlined-adornment-comment",sx:{fontSize:16},children:r("home.comment")}),n(_,{id:"outlined-adornment-comment",placeholder:r("home.commentInput"),fullWidth:!0,multiline:!0,autoComplete:"off",minRows:2,maxRows:2,value:A,onChange:Ne,startAdornment:n(k,{position:"start"}),label:r("home.comment"),inputProps:{maxLength:150}})]}),d(E,{fullWidth:!0,sx:{mb:2},children:[n(T,{htmlFor:"outlined-adornment-expedit",sx:{fontSize:16},error:x?x.boo:!1,children:r("home.expedit")}),n(_,{id:"outlined-adornment-expedit",placeholder:r("home.expeditInput"),type:"InputNumber",size:"medium",autoComplete:"off",fullWidth:!0,value:c,onChange:Ce,startAdornment:n(k,{position:"start"}),label:r("home.expedit"),error:x?x.boo:!1}),n($,{error:!0,children:x?x.text:""})]}),me===2&&Number(L)!==0?d(N,{direction:"row",mb:3,alignItems:"center",children:[d(p,{mr:.5,variant:"body2",children:[r("home.expedited"),":"]}),d(p,{variant:"body2",children:[c," ",q]}),n(p,{mx:.5,children:"â‰ˆ"}),d(p,{variant:"body2",mr:1,children:[L," IBXC"]}),n(He,{title:r("user.urgentpay"),placement:"bottom",children:n(Be,{fontSize:"medium",sx:{cursor:"pointer"}})})]}):"",d(N,{direction:"row",justifyContent:"space-around",children:[n(re,{variant:"outlined",onClick:we,sx:{width:"40%",minWidth:120,lineHeight:2.4},size:"large",children:r("login.cancel")}),n(re,{variant:"filled",onClick:ke,sx:{width:"40%",minWidth:120,lineHeight:2.4},size:"large",children:r("login.confirm")})]})]})}),S==="address"?n(se,{isCheck:U,params:{contractName:"MultiSignPropose",Wallet:P.addressString(y),To:g,Amount:i.parseUnits(C,Number(e==null?void 0:e.digits)),digits:Number(e==null?void 0:e.digits),Ecosystem:h,Expedite:String(c)?String(c):"0",Proposal:A},close:I,confirm:z}):n(se,{isCheck:U,params:{contractName:"MultiSignPropose",Wallet:P.addressString(y),iName:g,Amount:i.parseUnits(C,Number(e==null?void 0:e.digits)),digits:Number(e==null?void 0:e.digits),Ecosystem:h,Expedite:String(c)?String(c):"0",Proposal:A},close:I,confirm:z})]})};export{at as Component};
